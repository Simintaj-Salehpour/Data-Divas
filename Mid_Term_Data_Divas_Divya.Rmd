---
title: "Mid-term Project"
author: "Simintaj Salehpour, Madeline Bumpus, Nazish Atta, Divya Mistry"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(skimr)
library(ggplot2)
library(naniar)
library(broom)
```

### Examining the Relationship Between Demographics, Admission Types, and Clinical Outcomes in New York Inpatients (Niagara County)

## 1. Introduction

**Due:** October 22nd (Wednesday, End of Day)

This R Markdown performs an exploratory data analysis (EDA) for the dataset CortlandCounty_Discharge2016.csv.
It includes code, explanation, dataset summary, descriptive statistics, graphical displays, variance/SD measures, normality checks, and initial statistical tests.

## 2. Load dataset
```{r smart-question, include=T}
# Load CSV file
data <- read.csv("Hospital_Inpatient_Discharges.csv", stringsAsFactors = FALSE)

#Clean column names to avoid backticks

names(data) <- make.names(names(data))

cat("Dataset dimensions: Rows:", nrow(data), "Columns:", ncol(data), "\n")
glimpse(data)

```

## 3. Handle missing value

Here I check if there is a missing value or not. For each column check the missing value.

```{r missing-values, echo=FALSE, include=TRUE, results='markup', message=FALSE, warning=FALSE}

# --- 1. Summary of missing values ---
missing_summary <- data %>%
summarise(across(everything(), ~sum(is.na(.)))) %>%
pivot_longer(everything(), names_to = "column(variable)", values_to = "n_missing") %>%
arrange(desc(n_missing))

missing_summary

# --- 2. Visualize missingness per column ---
gg_miss_var(data) +
labs(title = "Variables vs. Number of Missing Values") +
theme(plot.title = element_text(face = "bold", color = "darkblue"))

# --- 3. Check if there are any missing values ---
clean_data <- data
if(any(is.na(data))) {
total_missing <- sum(is.na(data))
total_cells <- nrow(data) * ncol(data)
  
  # Remove rows if missing values are few (<5% of total data)
if(total_missing / total_cells < 0.05) {
clean_data <- na.omit(data)
cat("Rows with missing values removed.\n")
} else {
for(col in names(clean_data)) {
if(is.numeric(clean_data[[col]])) {
clean_data[[col]][is.na(clean_data[[col]])] <- median(clean_data[[col]], na.rm = TRUE)
}
}
    cat("Missing numeric values replaced with median.\n")
}
} else {
cat("No missing values detected.\n")
}
```

## 4. Remove Duplicates
Here I check to remove duplicates:
```{r Remove Duplicates, include=T, results = "markup"}
dup_count <- sum(duplicated(clean_data))
cat("Number of duplicate rows:", dup_count, "\n")

#Remove duplicates
clean_data <- clean_data %>% distinct()
```

## 5. Descriptive statistics

```{r descriptive-stats, include=T, results = "markup"}
# For numeric columns
cat("Numeric Columns summary:")
num_vars <- clean_data %>% select(where(is.numeric))
skim(num_vars)


# Categorical Columns Summary (top counts for first 5 columns)
cat_vars <- clean_data %>% select(where(~!is.numeric(.)))
cols_to_show <- names(cat_vars)[1:min(5, ncol(cat_vars))]

cat("Categorical Columns Summary (first", length(cols_to_show), "columns):\n\n")

for(col in cols_to_show) {
  cat("Column:", col, "\n")
  counts <- sort(table(cat_vars[[col]]), decreasing = TRUE)
  print(head(counts, 6))  # top 6 categories
  cat("\n")
}
```
  
```{r smart-question3, echo=FALSE, include=TRUE, results='asis', message=FALSE, warning=FALSE}
# Use cleaned dataset
data_df <- clean_data
# Inspect columns
table(data_df$Discharge.Year, useNA="ifany")
table(data_df$Age.Group, useNA="ifany")
# Create age buckets
data_df <- data_df %>%
mutate(age_bucket = case_when(
  grepl("70", Age.Group, ignore.case = TRUE) ~ "70+",
  grepl("30", Age.Group, ignore.case = TRUE) & grepl("49", Age.Group, ignore.case = TRUE) ~ "30-49",
  TRUE ~ NA_character_
))
cat("Age buckets created. Here are the counts:\n")
print(table(data_df$age_bucket, useNA="ifany"))
# Clean Length of Stay
data_df$Length.of.Stay <- as.numeric(data_df$Length.of.Stay)
cat("Length.of.Stay cleaned. Sample values:\n")
print(head(data_df$Length.of.Stay, 10))
# Subsets
g70 <- data_df %>% filter(age_bucket == "70+") %>% pull(Length.of.Stay)
g30 <- data_df %>% filter(age_bucket == "30-49") %>% pull(Length.of.Stay)
cat("Number of 70+ patients:", length(g70), "\n")
cat("Number of 30-49 patients:", length(g30), "\n")
# Descriptive stats
summary_stats <- data_df %>%
group_by(age_bucket) %>%
summarise(
n = n(),
mean = mean(Length.of.Stay, na.rm=TRUE),
median = median(Length.of.Stay, na.rm=TRUE),
sd = sd(Length.of.Stay, na.rm=TRUE)
)
summary_stats
cat("Descriptive statistics by age bucket:\n")
print(summary_stats)
#percent difference
mean70 <- mean(g70, na.rm=TRUE)
mean30 <- mean(g30, na.rm=TRUE)
percent_longer <- (mean70 - mean30) / mean30 * 100
cat("\nPercent longer stay for 70+ vs 30–49:", round(percent_longer,2), "%\n")
cat("Count of observations:\n")
cat("70+ group:", sum(!is.na(g70)), "\n")
cat("30-49 group:", sum(!is.na(g30)), "\n")
# Check data availability
n70 <- sum(!is.na(g70))
n30 <- sum(!is.na(g30))

cat("Number of observations:\n")
cat("70+ group:", n70, "\n")
cat("30–49 group:", n30, "\n")

# Run t-test only if both groups have at least 2 valid observations
if (n70 > 1 & n30 > 1) {
  tres <- t.test(g70, g30, var.equal = FALSE)
  print(tres)
} else {
  cat("\n❌ Not enough data for Welch t-test. Skipping this step.\n")
}
# SMART Question 3: Do elderly patients (70+) stay 25% longer than patients aged 30–49?

# 1. Load dataset
df <- read.csv("Niagara_smaller.csv", stringsAsFactors = FALSE)

# 2. Clean and inspect Age.Group
df$Age.Group <- trimws(df$Age.Group)
cat("Unique Age Groups:\n")
print(unique(df$Age.Group))

# 3. Flexible filter for the two target groups
df_age <- df %>%
  filter(
    (grepl("30", Age.Group, ignore.case = TRUE) & grepl("49", Age.Group, ignore.case = TRUE)) |
    grepl("70", Age.Group, ignore.case = TRUE)
  ) %>%
  droplevels()

# 4. Clean Length.of.Stay
df_age$Length.of.Stay <- suppressWarnings(as.numeric(df_age$Length.of.Stay))
df_age <- df_age %>% filter(!is.na(Length.of.Stay))

# 5. Check resulting groups
cat("\nGroups after filtering:\n")
print(table(df_age$Age.Group, useNA="ifany"))

# Proceed only if two groups with valid data
if (length(unique(df_age$Age.Group)) == 2 &&
    all(sapply(split(df_age$Length.of.Stay, df_age$Age.Group), function(x) length(x) > 1))) {
  
  # Group means
  age_means <- df_age %>%
    group_by(Age.Group) %>%
    summarise(mean_LOS = mean(Length.of.Stay, na.rm = TRUE))
  print(age_means)
  
  # Calculate ratio
  ratio_age <- age_means$mean_LOS[grepl("70", age_means$Age.Group)] /
               age_means$mean_LOS[grepl("30", age_means$Age.Group)]
  cat("\nElderly / 30–49 ratio =", round(ratio_age, 2), "\n")
  
  # One-sided t-test (elderly > younger)
  cat("\nWelch Two Sample t-test:\n")
  print(t.test(Length.of.Stay ~ Age.Group, data = df_age, alternative = "greater"))
  
  # Boxplot
  ggplot(df_age, aes(x = Age.Group, y = Length.of.Stay, fill = Age.Group)) +
    geom_boxplot() +
    theme_minimal() +
    labs(title = "Length of Stay by Age Group (Niagara)",
         x = "Age Group", y = "Length of Stay (days)")
  
} else {
  cat("\n❌ Cannot run t-test. Check data integrity.\n")
}
```
```{r conclusion, include=T}
cat("If p-value < 0.05\n",
    "Since the p-value is less than 0.05, we reject the null hypothesis.\n",
    "This means there is a statistically significant difference between the two group means.\n",
    "In other words, the observed difference is unlikely to have occurred by random chance.\n\n")

cat("If p-value ≥ 0.05\n",
    "Since the p-value is greater than 0.05, we fail to reject the null hypothesis.\n",
    "This indicates there is no statistically significant difference between the group means.\n",
    "The difference observed could be due to random variation.\n")
```
end

