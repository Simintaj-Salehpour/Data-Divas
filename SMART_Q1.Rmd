---
title: "SMART_Q1"
output: html_document
date: "2025-10-16"
---
### Research Question 1  
**Did Medicare patients have, on average, at least 15% longer hospital stays than Private Insurance patients in Niagara County (2012)?**
```{r setup, echo = F}


library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)


### Clean, combine insurance columns, and remove outlier

data <- read.csv("Hospital_Inpatient_Discharges.csv")

clean_data <- data
if(any(is.na(data))) {
  
  cat("Missing values detected!\n")
  total_missing <- sum(is.na(data))
  total_cells <- nrow(data) * ncol(data)
  
  # Remove rows if missing values are few (<5% of total data)
  if(total_missing / total_cells < 0.05) {
    clean_data <- na.omit(data)
    cat("Rows with missing values removed.\n")
  } 
  else {
    # Impute numeric columns with median
    for(col in names(clean_data)) {
      if(is.numeric(clean_data[[col]])) {          # Check if the column is numeric
          clean_data[[col]][is.na(clean_data[[col]])] <- median(clean_data[[col]], na.rm = TRUE)  
      }
    }
    cat("Missing values in numeric columns replaced with median.\n")
  }
  
} else {
  cat("No missing values detected. Dataset is clean.\n")
}
#remove duplicates
clean_data <- clean_data %>% distinct()

df <- data %>%
  mutate(
    Insurance_Group = case_when(
      Payment.Typology.1 == "Medicare" |
        Payment.Typology.2 == "Medicare" |
        Payment.Typology.3 == "Medicare" ~ "Medicare",
      Payment.Typology.1 %in% c("Blue Cross/Blue Shield", "Private Health Insurance") |
        Payment.Typology.2 %in% c("Blue Cross/Blue Shield", "Private Health Insurance") |
        Payment.Typology.3 %in% c("Blue Cross/Blue Shield", "Private Health Insurance") ~ "Private Insurance",
      TRUE ~ NA_character_
    ),
    Length.of.Stay = as.numeric(Length.of.Stay)  
  ) %>%
  filter(!is.na(Insurance_Group), !is.na(Length.of.Stay)) %>%
  group_by(Insurance_Group) %>%
  filter(between(
    Length.of.Stay,
    quantile(Length.of.Stay, 0.25, na.rm = TRUE) - 1.5 * IQR(Length.of.Stay, na.rm = TRUE),
    quantile(Length.of.Stay, 0.75, na.rm = TRUE) + 1.5 * IQR(Length.of.Stay, na.rm = TRUE)
  )) %>%
  ungroup()


# Descriptive Statistics

  group_stats <- df %>%
  group_by(`Insurance_Group`) %>%
  summarise(
    mean_LOS = mean(`Length.of.Stay`, na.rm = TRUE),
    sd_LOS = sd(`Length.of.Stay`, na.rm = TRUE),
    count = n()
  )

group_stats


# Compute ratio of mean LOS (Medicare / Private)

ratio <- group_stats$mean_LOS[group_stats$`Insurance_Group` == "Medicare"] /
         group_stats$mean_LOS[group_stats$`Insurance_Group` == "Private Insurance"]

cat("Mean Medicare LOS is", round(ratio, 2), "times that of Private Insurance.\n")


# One sided t-test


t_result <- t.test(Length.of.Stay ~ Insurance_Group,
                   data = df,
                   alternative = "greater",
                   na.action = na.omit)


t_result

print(group_stats)


# Interpretation

p_val <- t_result$p.value
medicare_mean <- group_stats$mean_LOS[group_stats$`Insurance_Group` == "Medicare"]
private_mean <- group_stats$mean_LOS[group_stats$`Insurance_Group` == "Private Insurance"]
diff_ratio <- (medicare_mean / private_mean)
percent_diff <- (diff_ratio - 1) * 100



if (p_val < 0.05 & diff_ratio >= 1.15) {
  cat("Medicare patients stayed significantly longer on average.\n",
      "The mean length of stay for Medicare patients (", round(medicare_mean, 2), " days) ",
      "was about ", round(percent_diff, 1), "% longer than for Private Insurance patients (",
      round(private_mean, 2), " days), with p = ", round(p_val, 4),
      ". This difference is statistically significant (p < 0.05).", sep = "")
} else {
  cat("The data do not show a statistically significant difference of at least 15% in average hospital stay ",
      "between Medicare and Private Insurance patients. p =", round(p_val, 4))
}


# Visualization
ggplot(group_stats, aes(x = Insurance_Group, y = mean_LOS, fill = Insurance_Group)) +
  geom_bar(stat = "identity", width = 0.6, color = "black") +
  geom_text(aes(label = round(mean_LOS, 2)), vjust = -0.4, size = 4) +
  labs(title = "Average Hospital Length of Stay by Insurance Type (Niagara County, 2012)",
       x = "Insurance Type",
       y = "Mean Length of Stay (Days)") +
  theme_minimal() +
  theme(legend.position = "none")
```

